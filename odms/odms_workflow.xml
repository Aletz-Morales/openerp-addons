<?xml version="1.0"?>
<!-- In this file you declare your worflow(s) and their activities and transitions 
-->

  <terp>
      <data>
	

	<!-- Workflow declarations -->
	<!-- 	model : set to workflow (this is not the object)
		id : The id of the workflow
		name : The workflow name without the module name
		osv : The object used by this worflow to find the datas
		on_create : Generate the workflow at 
	-->

          <record model="workflow" id="workflow_subscription">
              <field name="name">workflow.subscription</field>
              <field name="osv">odms.subscription</field>
              <field name="on_create">True</field>
          </record>

	<!-- Activities Definitions -->
	<!-- 
		model : Set to workflow.activity for an activity
		id : The activity id
		wkf_id : The worflow (define before) using this activity
		name : The name of the activity
		split_mode : The type of split_mode :
			OR : One necessary transition, takes the first one found (default)
			XOR : Take only valid transitions (0 or more) in sequential order.
			AND : All valid transitions are launched at the same time (fork).
		join_mode : The type of join mode :
			XOR : One transition necessary to continue to the destination activity (default).
			AND : Waits for all transition conditions to be valid to execute the destination activity.
		kind : The kind (type) of activity :
			dummy : Do nothing
			funtion : When this activity happens, some code is executed
			subflow : The sub-workflow to link this workflow to
		action : A funtion or python code to execute with this activity
		
		flow_start : Set to True for a starting activity (start point of the workflow)
		flow_stop : Set to True for a ending activity (end point of the workflow)
		
	-->

	  <record model="workflow.activity" id="activity_draft">
	      <field name="wkf_id" ref="workflow_subscription"/>
	      <field name="name">activity.draft</field>
	      <field name="split_mode">XOR</field>
	      <field name="join_mode">XOR</field>
	      <field name="kind">function</field>
              <field name="action">write({'state':'draft'})</field>
	      <field name="flow_start">True</field>
	  </record>

	  <record model="workflow.activity" id="activity_active">
              <field name="wkf_id" ref="workflow_subscription"/>
              <field name="name">activity.active</field>
              <field name="split_mode">XOR</field>
              <field name="join_mode">XOR</field>
              <field name="kind">function</field>
	      <field name="flow_stop">True</field>
	      <field name="action">write({'state':'active'})</field>
          </record>

	  <record model="workflow.activity" id="activity_trial">
              <field name="wkf_id" ref="workflow_subscription"/>
              <field name="name">activity.trial</field>
              <field name="split_mode">XOR</field>
              <field name="join_mode">XOR</field>
              <field name="kind">function</field>
              <field name="action">write({'state':'trial'})</field>
          </record>

	 <record model="workflow.activity" id="activity_suspended">
              <field name="wkf_id" ref="workflow_subscription"/>
              <field name="name">activity.suspended</field>
              <field name="split_mode">XOR</field>
              <field name="join_mode">XOR</field>
              <field name="kind">function</field>
              <field name="action">write({'state':'suspended'})</field>
          </record>

	 <record model="workflow.activity" id="activity_deleted">
              <field name="wkf_id" ref="workflow_subscription"/>
              <field name="name">activity.deleted</field>
              <field name="split_mode">XOR</field>
              <field name="join_mode">XOR</field>
              <field name="kind">function</field>
	      <field name="flow_stop">True</field>
              <field name="action">write({'state':'deleted'})</field>
          </record>

	<!--
		subflow_id : The id of the sub workflow
	-->

          <record model="workflow.activity" id="activity_invoice">
              <field name="wkf_id" ref="workflow_subscription"/>
              <field name="name">activity.invoice</field>
              <field name="split_mode">XOR</field>
              <field name="join_mode">XOR</field>
              <field name="kind">subflow</field>
	      <field name="subflow_id" ref="account.wkf" />
	      <field name="action">make_invoice()</field> 
          </record>


	<!-- Transitions Definitions -->
	<!--
		model : Set to workflow.transition for a transition
		id : The transition id
		act_from : The source activity
		act_to : The destination activity
		signal : The name of signal that activate that transition	
			A signal can be generated a button or the result value of another workflow
	-->

	  <record model="workflow.transition" id="transition_trial">
	      <field name="act_from" ref="activity_draft"/>
	      <field name="act_to" ref="activity_trial"/>
	      <field name="signal">create_trial</field>
	  </record>

          <record model="workflow.transition" id="transition_invoice">
              <field name="act_from" ref="activity_draft"/>
              <field name="act_to" ref="activity_invoice"/>
              <field name="signal">make_invoice</field>
          </record>

          <record model="workflow.transition" id="transition_draft">
              <field name="act_from" ref="activity_trial"/>
              <field name="act_to" ref="activity_draft"/>
              <field name="signal">settodraft</field>
          </record>

         <record model="workflow.transition" id="transition_active">
              <field name="act_from" ref="activity_invoice"/>
              <field name="act_to" ref="activity_active"/>
	      <field name="signal">subflow.paid</field>
          </record>

         <record model="workflow.transition" id="transition_inv_cancel">
              <field name="act_from" ref="activity_invoice"/>
              <field name="act_to" ref="activity_suspended"/>
              <field name="signal">subflow.cancel</field>
          </record>

         <record model="workflow.transition" id="transition_suspend">
              <field name="act_from" ref="activity_active"/>
              <field name="act_to" ref="activity_suspended"/>
              <field name="signal">suspend_subs</field>
          </record>

	 <record model="workflow.transition" id="transition_delete">
              <field name="act_from" ref="activity_suspended"/>
              <field name="act_to" ref="activity_deleted"/>
              <field name="signal">delete_subs</field>
          </record>

	
      </data>
  </terp>
