<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    
    <data>
        <record model="ir.rule.group" id="portal_supplier_rule_group">
            <field name="name">Portal Supplier Rule</field>
            <field name="model_id" search="[('model', '=', 'purchase.order.line')]" model="ir.model" />
            <field name="global" eval="False" />
        </record>

        <record model="ir.rule" id="portal_supplier_purchase_order_line_rule">
            <field name="field_id" search="[('model', '=', 'purchase.order.line'),('name', '=', 'order_id')]" model="ir.model.fields" />
            <field name="operator">=</field>
            <field name="operand">user.address_id.partner_id.id</field>
            <field name="domain_force">[('order_id.partner_id.id', '=', user.address_id.partner_id.id)]</field>
            <field name="rule_group" ref="portal_supplier_rule_group"/>
        </record>

        <record id="purchase_order_line_form_portal" model="ir.ui.view">
            <field name="name">purchase.order.line.form.portal</field>
            <field name="model">purchase.order.line</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Purchase Order Line">
                    <notebook>
                        <page string="Order Line">
                            <field name="name" colspan="4" />
                            <field name="product_id" readonly="True" />
                            <field name="product_qty" readonly="True" />
                            <field name="product_uom" readonly="True" />
                            <field name="date_planned" readonly="True" />
                            <field name="confirmed_supplier" />
                        </page>
                        <page string="Notes">
                            <field colspan="4" name="notes" nolabel="1"/>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <record model="portal.model" id="model_purchase_order_line">
            <field name="name">Purchase Order Line</field>
            <field name="model_id" search="[('model', '=', 'purchase.order.line')]"/>
            <field name="rule_group_id" ref="portal_supplier_rule_group" />
            <field name="view_ids" eval="[(6, 0, [ref('purchase.purchase_order_line_tree'), ref('purchase_order_line_form_portal')])]"/>
        </record>

        <record model="res.groups" id="res_groups_portal_supplier">
            <field name="name">Portal Supplier Group</field>
            <field name="rule_groups" eval="[(4, ref('portal_supplier_rule_group'))]" />
        </record>

        <record model="ir.model.access" id="model_access_purchase_order_lines">
            <field name="name">Purchase Order Lines</field>
            <field name="perm_read">True</field>
            <field name="perm_write">True</field>
            <field name="group_id" ref="res_groups_portal_supplier" />
            <field name="model_id" search="[('model', '=', 'purchase.order.line')]" />
        </record>

        <record model="ir.actions.act_window" id="portal_supplier_purchase_order_lines_action">
            <field name="name">Your Purchase Order Lines</field>
            <field name="res_model">purchase.order.line</field>
            <field name="view_type">form</field>
        </record>
        <record model="ir.actions.act_window.view" id="window_view_tree_inv">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="account.invoice_tree"/>
            <field name="act_window_id" ref="portal_supplier_purchase_order_lines_action" />
        </record>
        <record model="ir.actions.act_window.view" id="window_view_form_inv">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="account.invoice_form"/>
            <field name="act_window_id" ref="portal_supplier_purchase_order_lines_action" />
        </record>

        <menuitem name="Supplier Portal" id="menu_portal_supplier" parent="portal.menu_portal_root" />
        <menuitem name="Purchase Order Lines" id="menu_portal_purchase_order_lines" parent="menu_portal_supplier" />
        <menuitem parent="menu_portal_purchase_order_lines" action="portal_supplier_purchase_order_lines_action" id="menu_portal_your_purchase_order_line_mi" />

    </data>
</openerp>
